---
title: "Lifecycle"
---

export const GitHubDoc = () => {
  const [content, setContent] = React.useState('Loading content from GitHub...');
  const [loading, setLoading] = React.useState(true);

  React.useEffect(() => {
    const fetchDoc = async () => {
      try {
        const response = await fetch('https://api.github.com/repos/masumi-network/kodosumi/contents/docs/lifecycle.md?ref=dev');
        const data = await response.json();
        const decodedContent = atob(data.content);
        setContent(decodedContent);
        setLoading(false);
      } catch (error) {
        setContent('Error loading content from GitHub. Please check the repository.');
        setLoading(false);
      }
    };

    fetchDoc();
  }, []);

  const renderMarkdown = (markdown) => {
    // Process tables with a more flexible regex
    let processedMarkdown = markdown.replace(/(\|[^\n]+\|\n\|[\s\-\|:]+\|\n(?:\|[^\n]+\|\n?)+)/gm, (match) => {
      const lines = match.trim().split('\n');
      if (lines.length < 3) return match; // Need at least header, separator, and one data row
      
      const headerLine = lines[0];
      const dataLines = lines.slice(2); // Skip separator line
      
      const headers = headerLine.split('|').map(h => h.trim()).filter(h => h !== '');
      const rows = dataLines.map(line => {
        const cells = line.split('|').map(cell => cell.trim()).filter(cell => cell !== '');
        // Ensure row has same number of cells as headers
        return cells.slice(0, headers.length);
      }).filter(row => row.length > 0);
      
      let tableHtml = '<table style="border-collapse: collapse; width: 100%; margin: 20px 0;">';
      tableHtml += '<thead><tr>';
      headers.forEach(header => {
        tableHtml += `<th style="border: 1px solid var(--kodosumi-green-alpha, rgba(196, 254, 10, 0.3)); padding: 12px; background: var(--kodosumi-green-alpha, rgba(196, 254, 10, 0.1)); text-align: left; font-weight: 600;">${header}</th>`;
      });
      tableHtml += '</tr></thead><tbody>';
      
      rows.forEach(row => {
        if (row.length > 0) {
          tableHtml += '<tr>';
          row.forEach(cell => {
            tableHtml += `<td style="border: 1px solid var(--kodosumi-green-alpha, rgba(196, 254, 10, 0.3)); padding: 12px;">${cell}</td>`;
          });
          tableHtml += '</tr>';
        }
      });
      
      tableHtml += '</tbody></table>';
      return tableHtml;
    });

    return processedMarkdown
      .replace(/^# (.*$)/gim, '<h1>$1</h1>')
      .replace(/^## (.*$)/gim, '<h2>$1</h2>')
      .replace(/^### (.*$)/gim, '<h3>$1</h3>')
      .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
      .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/gim, '<em>$1</em>')
      .replace(/```bash([\s\S]*?)```/gim, '<pre><code class="language-bash">$1</code></pre>')
      .replace(/```([\s\S]*?)```/gim, '<pre><code>$1</code></pre>')
      .replace(/`([^`]*)`/gim, '<code>$1</code>')
      .replace(/!\[([^\]]*)\]\(([^)]*)\)/gim, (match, alt, src) => {
        const absoluteSrc = src.startsWith('http') 
          ? src 
          : `https://raw.githubusercontent.com/masumi-network/kodosumi/main/docs/${src}`;
        return `<img src="${absoluteSrc}" alt="${alt}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 10px 0;" />`;
      })
      .replace(/\[([^\]]*)\]\(([^)]*)\)/gim, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
      // Handle bullet lists
      .replace(/^\* `([^`]+)`([^\n]*)/gm, '<li><code>$1</code>$2</li>')
      .replace(/^\* ([^\n]+)/gm, '<li>$1</li>')
      .replace(/^\- ([^\n]+)/gm, '<li>$1</li>')
      .replace(/^\d+\. ([^\n]+)/gm, '<li>$1</li>')
      // Wrap consecutive list items in ul tags
      .replace(/(<li>.*<\/li>\s*)+/gs, (match) => `<ul>${match}</ul>`)
      // Handle paragraphs
      .replace(/\n\n+/g, '</p><p>')
      .replace(/\n/g, '<br>')
      .replace(/^(?!<[ht])/g, '<p>')
      .replace(/(?<!\>)$/g, '</p>')
      // Clean up malformed tags
      .replace(/<p><\/p>/g, '')
      .replace(/<p>(<(?:table|h[1-6]|ul|ol))/g, '$1')
      .replace(/(<\/(?:table|h[1-6]|ul|ol)>)<\/p>/g, '$1');
  };

  if (loading) {
    return (
      <div style={{ padding: '20px', textAlign: 'center' }}>
        <p>ðŸ”„ Loading content from GitHub...</p>
      </div>
    );
  }

  return (
    <div 
      style={{ 
        lineHeight: '1.6',
        fontFamily: 'inherit'
      }}
      dangerouslySetInnerHTML={{ 
        __html: renderMarkdown(content) 
      }}
    />
  );
};

<GitHubDoc />